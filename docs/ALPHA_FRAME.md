# Alpha Frame: The Pre-Cubic Foundation

## Concept

The Alpha Frame is the condition that exists before the Z2-cubed cube instantiates. It is the bootloader, kernel, and initial process -- the absolute minimum required to bring the eight vertices into existence.

In nuclear physics, the Alpha Frame corresponds to the primordial hydrogen from which all heavier elements are synthesized. The Alpha Frame does not classify itself into any vertex. It is pre-classification, pre-structure, pre-cube. Its only purpose is to create the conditions under which the cube can exist.

## Components

### 1. Bootloader (Pre-Alpha)

The bootloader is not even part of the Alpha Frame proper -- it is the big bang that creates the Alpha Frame. Waterlight supports:

- **EFISTUB**: Kernel loaded directly by UEFI firmware (minimal)
- **syslinux**: For legacy BIOS boot (lightweight)
- **GRUB**: For complex multi-boot scenarios (heavyweight, use only if needed)

The hydrogen principle demands the simplest bootloader that works. For UEFI systems, EFISTUB is preferred -- the kernel IS the bootloader.

### 2. Kernel Image

The kernel is the Alpha Frame's core. Waterlight uses a custom-configured Linux kernel with:

**Always compiled in (no modules):**
- Essential filesystem support (ext4, btrfs, vfat)
- Essential block device support
- Core networking (IPv4, IPv6, TCP, UDP)
- Namespaces (all types)
- Cgroups v2
- eBPF subsystem
- Capabilities support
- Overlayfs

**As modules (loaded during hydrogen phase):**
- Hardware-specific drivers
- Optional filesystems
- Advanced networking (netfilter, nftables)
- Sound, graphics (if desktop use)

**Kernel configuration philosophy:**
- Enable everything needed for the cube to function
- Disable everything that is not the kernel's job
- Prefer compiled-in over modules for essential subsystems
- Minimize kernel surface area for security

### 3. initramfs

The initramfs is the embryonic root filesystem. It contains:

```
/
├── bin/
│   ├── busybox          # All essential commands
│   └── waterlight-init  # PID 1
├── etc/
│   └── waterlight/
│       └── alpha.conf   # Minimal boot config
├── lib/
│   └── modules/         # Essential kernel modules
├── dev/                 # Will be populated
├── proc/                # Mount point
├── sys/                 # Mount point
└── run/                 # Runtime directory
```

The initramfs is generated by the build system and contains only what is needed for the hydrogen phase. It is intentionally minimal -- every byte matters in the Alpha Frame.

### 4. waterlight-init (PID 1)

The init system is a shell script (initially) that becomes a compiled binary (in later versions). As PID 1, it:

1. Never exits (kernel panics if PID 1 dies)
2. Reaps orphaned child processes
3. Handles signals (SIGTERM for shutdown, SIGHUP for reload)
4. Orchestrates the nucleosynthesis boot sequence

## Nucleosynthesis Boot Sequence

### Phase 1: Hydrogen (t=0)

The absolute minimum to have a functional Linux system.

```
waterlight-init starts
  |
  +-- mount -t proc proc /proc
  +-- mount -t sysfs sysfs /sys
  +-- mount -t devtmpfs devtmpfs /dev
  +-- mkdir -p /dev/pts /dev/shm
  +-- mount -t devpts devpts /dev/pts
  +-- mount -t tmpfs tmpfs /dev/shm
  +-- mount -t tmpfs tmpfs /run
  |
  +-- Load essential kernel modules
  |   modprobe loop
  |   modprobe btrfs (or ext4)
  |   (hardware-specific modules)
  |
  +-- Mount real root filesystem
  |   mount /dev/sda2 /mnt/root
  |
  +-- Pivot root
  |   pivot_root /mnt/root /mnt/root/alpha
  |   exec chroot / /usr/lib/waterlight/alpha-frame/init-phase2.sh
```

### Phase 2: Helium Fusion (t=1)

Create the structural framework for the cube.

```
Create cgroup v2 hierarchy:
  /sys/fs/cgroup/waterlight.slice/
    neutrino.slice/    (V000)
    antineutrino.slice/ (V001)
    photon.slice/      (V100)
    antiphoton.slice/  (V101)
    electron.slice/    (V110)
    positron.slice/    (V111)

Initialize runtime state:
  /run/waterlight/vertex-state    (vertex status tracking)
  /run/waterlight/chirality       (current sigma mode)
  /run/waterlight/membrane/       (active membrane descriptors)

Set system identity:
  hostname
  timezone
  entropy seeding (from hardware RNG or stored seed)
```

### Phase 3: Carbon Fusion (t=2)

Start the foundational services that everything else depends on.

```
V000 services (kernel-adjacent):
  udevd           -- device event daemon
  klogd/syslogd   -- kernel log capture

V100 services (lightweight production):
  syslogd         -- system logging
  crond           -- scheduled tasks
  networkd        -- network configuration
  ntpd            -- time synchronization
```

### Phase 4: Oxygen Fusion (t=3)

Start the application-level services.

```
V110 services (heavyweight production):
  Databases, web servers, application services
  (As defined in /etc/waterlight/fusion/ directory)

If chirality=antimatter (sigma=1):
  V101 services (lightweight development):
    File watchers, linters, dev tools
  V111 services (heavyweight development):
    Debuggers, profilers, test infrastructure
```

### Phase 5: Iron Ceiling (t=4)

The system is fully booted. No more automatic service starts.

```
Write /run/waterlight/boot-complete
Log boot time and phase durations
Transition to steady-state supervision mode:
  - Reap orphaned processes
  - Restart failed services (if configured)
  - Handle shutdown signals
  - Monitor vertex health
```

## Shutdown Sequence: Reverse Nucleosynthesis

Shutdown reverses the fusion sequence -- heavy elements decay first.

```
Phase -1: Stop all V110/V111 services (oxygen -> carbon)
Phase -2: Stop all V100/V101 services (carbon -> helium)
Phase -3: Dismantle cgroup hierarchy (helium -> hydrogen)
Phase -4: Unmount filesystems, sync disks
Phase -5: Signal kernel for halt/reboot/poweroff
```

## Alpha Frame Configuration

```ini
# /etc/waterlight/alpha.conf
# Alpha Frame configuration -- loaded before the cube exists

[boot]
# Root filesystem device
root=/dev/sda2
root_fs=btrfs
root_opts=compress=zstd,noatime,subvol=@

# Boot mode
sigma=0              # 0=production, 1=development
verbose=0            # 0=quiet, 1=verbose boot

[hydrogen]
# Phase 1 modules to load
modules=btrfs loop

[helium]
# Phase 2 system identity
hostname=waterlight
timezone=UTC

[carbon]
# Phase 3 essential services
services=udevd syslogd crond networkd ntpd

[oxygen]
# Phase 4 application services
# (loaded from /etc/waterlight/fusion/ directory)

[iron]
# Boot complete actions
boot_log=/var/waterlight/log/boot.log
```

## Design Constraints

1. **The Alpha Frame must boot with no network.** All dependencies must be local.
2. **The Alpha Frame must boot with no user interaction.** Fully autonomous startup.
3. **The Alpha Frame must complete in < 5 seconds** on modern hardware (SSD, 4+ cores).
4. **The Alpha Frame must be reproducible.** Same inputs produce same boot sequence.
5. **The Alpha Frame must be auditable.** Every action is logged.
6. **The Alpha Frame must fail safely.** Boot failures drop to emergency shell, not kernel panic.
